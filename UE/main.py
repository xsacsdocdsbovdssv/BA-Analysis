from UE.merge_opening_data_into_financial_report import merge_opening_data_into_financial_report
from process_financial_report import process_financial_report
from process_storename import ExcelProcessor_zhuanhegui
from process_opening_report import process_opening_report

# 使用示例
if __name__ == "__main__":
    input1_file = "/Users/zhaozhilong/Desktop/work/半天妖/其他/商业分析/基础文档/管理报表/半天妖2025.03上交管理表完整版 - 不含#号.xlsx"
    input2_file = "/Users/zhaozhilong/Desktop/work/半天妖/其他/商业分析/基础文档/开台数/门店报表755f90a0770844c28cb965e07e006cd5.xlsx"
    lookup_file = "/Users/zhaozhilong/Desktop/work/半天妖/其他/商业分析/基础文档/转合规/转合规529+2家-2家店名3月.xlsx"

    try:
        # -------处理财务报表，转化为含有原始店名的UE报表的样式，并且将能获取到的数据填入报表--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        financial_result_file = process_financial_report(input1_file)
        print("处理完成process_financial_report")
        processor = ExcelProcessor_zhuanhegui(financial_result_file, lookup_file)
        processor.process(financial_result_file)
        print("处理完成process_storename")
        print(f"处理完成，结果文件: {financial_result_file}")

        # -------处理门店报表，转化为含有原始店名的简化版门店报表的样式--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        opening_result_file = input2_file
        processor = ExcelProcessor_zhuanhegui(opening_result_file, lookup_file)
        processor.process(opening_result_file)

        processed_input2 = process_opening_report(opening_result_file)
        print("处理完成process_storename")
        print(f"处理完成，结果文件: {opening_result_file}")

        # -------根据第二步生成的result_file中的原始店名字段，完善第一步生成的result_file--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        merged_result = merge_opening_data_into_financial_report(
            financial_file=financial_result_file,  # A 文件：第一步处理后的财务报表
            opening_file=opening_result_file  # B 文件：第二步处理后的开台报表
        )
        print(f"合并完成，最终输出文件: {merged_result}")

    except Exception as e:
        print(f"处理失败: {str(e)}")
